<html>

<head>
    <script src="../dist/TableProxy-0.9.0.js"></script>
</head>

<body>
    <div id='table'></div>
    <script>
        window.addEventListener("load", function () {
            SpreadsheetApp.div = document.getElementById('table');
            SpreadsheetApp.getActiveSpreadsheet().getSheetByName('Test');

            $initTableProxy('TP');
            const t = TP.mount('Test').setExportAttributes(['value','fontcolor']);
            const query = function (r) {
                // console.log(JSON.parse(JSON.stringify(r)));
                if (r['2-4 Value'].value.indexOf('-4') !== -1) {
                    r['2-5 Value'].background = 'red'; //OK
                    r['2-5 Value'].fontsize = 20; //OK
                    r['2-5 Value'].fontweight = 'bold'; //OK
                    r['2-5 Value'].note = 'fuckoff';
                    r['2-5 Value'].fontfamily = 'Georgia'; //OK
                    r['2-5 Value'].fontstyle = 'italic'; //OK
                    r['2-5 Value'].fontcolor = 'green';

                    return true;
                }
            }

/*             t.query(query, true);
            console.log(JSON.stringify(t.getLastResults()));
            t.flush();
            console.log(JSON.stringify(t.getLastResults()));



            console.log(t.unique('2-4 Value'));
            console.log(JSON.stringify(t.getLastResults())); 


            console.log(t.records());
            console.log(JSON.stringify(t.getLastResults())); */

            const records = JSON.parse(JSON.stringify(t.getExportObject().records));
            records[1]['C2'].value = 'poop';
            records[1]['C2'].fontcolor = 'red';
            records[2]['C3'].value = 'turd';
            records[4]['C3'].background = 'orange';

            t.update(records);
            console.log(t.getLastResults());

            /* t.setWriteLevel(TableProxy.WRITE_LEVEL_CELL);
            const st1 = Date.now()
            for(let i = 0; i< iterations; i++){
                t.query(query, true);
            }
            console.log(`${iterations} at cell write in ${Date.now()-st1}`);
            

            t.setWriteLevel(TableProxy.WRITE_LEVEL_ROW);
            const st2 = Date.now()
            for(let i = 0; i< iterations; i++){
                t.query(query, true);
            }
            console.log(`${iterations} at row write in ${Date.now()-st2}`);


            t.setWriteLevel(TableProxy.WRITE_LEVEL_TABLE);
            const st3 = Date.now()
            for(let i = 0; i< iterations; i++){
                t.query(query, true);
            }
            console.log(`${iterations} at row write in ${Date.now()-st3}`);
 */
        });

        function z() {
            s.getRange(4, 3, 2, 2).setBackgrounds([['blue', 'green'], ['orange', 'purple']]);
        }
    </script>




</body>

</html>